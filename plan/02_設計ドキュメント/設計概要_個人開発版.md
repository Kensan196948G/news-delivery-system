# 設計概要 - ニュース配信システム（個人開発版）

**プロジェクト:** ニュース自動配信システム  
**設計者:** 個人開発プロジェクト  
**作成日:** 2025年8月8日  
**状態:** 90%完了

---

## 📝 設計ファイル一覧

### 完成済み設計書
- [✓] **システム基本設計書** - 全体アーキテクチャ、モジュール設計
- [✓] **データベース設計書** - SQLiteスキーマ、テーブル設計
- [✓] **API設計書** - 外部API連携、エラーハンドリング

### 作業中・予定
- [ ] **設計レビューチェックリスト** - 簡易レビュー用
- [ ] **実装ガイドライン** - コーディング規約、ベストプラクティス

---

## 🏠 システム構成概要

### 個人用ローカル構成
```
ローカルPC (Windows/Linux)
├── メインアプリ (Python)
│   ├── ニュース収集モジュール
│   ├── 翻訳モジュール (DeepL)
│   ├── AI分析モジュール (Claude)
│   └── 配信モジュール (Gmail)
├── ローカルDB (SQLite)
├── ローカルファイル (外付HDD)
└── タスクスケジューラ (Windows/Linux)
```

### 主要コンポーネント
1. **ニュース収集** - NewsAPI, GNews, NVD API
2. **翻訳処理** - DeepL APIで英語→日本語
3. **AI分析** - Claude APIで要約・キーワード抽出・重要度判定
4. **レポート生成** - HTML/PDFフォーマット
5. **メール配信** - Gmail APIで1日3回自動配信
6. **データ管理** - SQLiteでローカル管理

---

## 📦 モジュール構成

### ファイル構造（簡略化版）
```
/news-delivery-system/
├── main.py                    # メイン実行ファイル
├── config/
│   ├── config.json          # 設定ファイル
│   └── .env                 # APIキー等
├── src/
│   ├── collectors/          # ニュース収集
│   ├── processors/          # 翻訳・分析
│   ├── generators/          # レポート生成
│   ├── notifiers/           # メール配信
│   ├── models/              # データモデル
│   └── utils/               # ユーティリティ
├── templates/               # HTMLテンプレート
├── tests/                   # テストコード
└── data/                    # データ保存先
```

### モジュール間のデータフロー
```
NewsAPI → 収集モジュール → 翻訳モジュール → AI分析モジュール
    ↓                                                          ↓
NVD API → 収集モジュール → データベース → レポート生成 → Gmail配信
    ↓                            ↑
GNews → 収集モジュール ──────┘
```

---

## 📊 データフロー

### 1. ニュース収集フェーズ
1. 各APIからカテゴリ別に記事収集
2. 重複チェック＆除去
3. 基本情報抽出（タイトル、URL、内容等）

### 2. 翻訳フェーズ
1. 言語自動判定
2. 英語記事のDeepL翻訳（タイトル・本文）
3. 翻訳結果キャッシュ保存

### 3. AI分析フェーズ
1. Claude APIによる記事分析
2. 要約生成（200-250文字）
3. 重要度スコア付与（1-10）
4. キーワード抽出（5個）
5. カテゴリ分類・センチメント分析

### 4. レポート生成フェーズ
1. カテゴリ別記事整理
2. HTMLメールテンプレート適用
3. PDF添付ファイル生成
4. 緊急アラート検出

### 5. 配信フェーズ
1. Gmail APIでHTMLメール送信
2. PDFファイル添付
3. 配信履歴記録
4. エラーハンドリング

---

## 🔧 技術スタック

### コア技術
- **メイン言語:** Python 3.11+
- **非同期処理:** asyncio, aiohttp
- **データベース:** SQLite3
- **テンプレート:** Jinja2
- **PDF生成:** wkhtmltopdf

### 外部API
- **ニュース:** NewsAPI (主), GNews API (補助)
- **セキュリティ:** NVD API (CVE情報)
- **翻訳:** DeepL API
- **AI分析:** Claude API (Anthropic)
- **メール:** Gmail API (OAuth2)

### ライブラリ一覧
```
aiohttp==3.9.0
anthropic==0.18.0
google-auth==2.23.0
google-api-python-client==2.100.0
jinja2==3.1.2
pdfkit==1.0.0
python-dotenv==1.0.0
requests==2.31.0
```

---

## ⚙️ 設定管理

### 環境変数 (.env)
```bash
# APIキー
NEWSAPI_KEY=your_newsapi_key
DEEPL_API_KEY=your_deepl_key
ANTHROPIC_API_KEY=your_claude_key
GNEWS_API_KEY=your_gnews_key

# Gmail OAuth
GMAIL_CREDENTIALS_PATH=config/gmail_credentials.json
GMAIL_TOKEN_PATH=config/gmail_token.json

# データベース
DB_PATH=data/news.db

# Context7設定
ANTHROPIC_CONTEXT_MODE=context7
ANTHROPIC_ENHANCED_REASONING=true
```

### 設定ファイル (config.json)
```json
{
  "collection": {
    "schedule": ["07:00", "12:00", "18:00"],
    "categories": {
      "domestic_social": { "count": 10, "enabled": true },
      "tech": { "count": 20, "enabled": true },
      "security": { "count": 15, "enabled": true }
    }
  },
  "delivery": {
    "recipients": ["your_email@example.com"],
    "emergency_threshold": 9
  }
}
```

---

## 📝 設計レビューチェックリスト

### システム設計
- [✓] モジュール分割は適切か
- [✓] エラーハンドリングは考慮されているか
- [✓] スケーラビリティは個人用で十分か
- [✓] セキュリティ要件を満たしているか

### データベース設計
- [✓] テーブル構造は適切か
- [✓] インデックス設計は最適化されているか
- [✓] バックアップ戦略は計画されているか

### API設計
- [✓] レート制限対応は適切か
- [✓] キャッシュ戦略は効率的か
- [✓] エラーリトライ機能は十分か

---

**最終更新:** 2025年8月8日  
**次回レビュー:** 2025年8月15日  
**ステータス:** 設計フェーズほぼ完了、Phase 2開発準備中