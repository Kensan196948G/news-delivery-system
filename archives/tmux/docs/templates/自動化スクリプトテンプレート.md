# è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé›†

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¦‚è¦
- ä½œæˆæ—¥æ™‚: 2025-07-11
- å¯¾è±¡: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºçµ±åˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- ä½œæˆè€…: dev4 (ã‚·ã‚¹ãƒ†ãƒ åˆ†æãƒ»çµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³è¨­è¨ˆ)

## 1. çµ±åˆå®Ÿè¡Œè‡ªå‹•åŒ–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### ğŸš€ Master Integration Script
```bash
#!/bin/bash
# ãƒã‚¹ã‚¿ãƒ¼çµ±åˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# ç”¨é€”: å…¨Phaseçµ±åˆå®Ÿè¡Œã®è‡ªå‹•åŒ–

echo "=== Master Integration Script ==="

# è¨­å®šå¤‰æ•°
export PROJECT_NAME="enterprise-integration"
export TARGET_DIR="$(pwd)"
export BACKUP_DIR="Archive/Backup-Snapshots"
export LOG_DIR="logs"
export TIMESTAMP=$(date +%Y%m%d_%H%M%S)

# ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p "$LOG_DIR"
exec > >(tee -a "$LOG_DIR/integration_$TIMESTAMP.log")
exec 2>&1

# çµ±åˆå®Ÿè¡Œé–¢æ•°
execute_integration() {
    echo "ğŸ¯ çµ±åˆå®Ÿè¡Œé–‹å§‹: $PROJECT_NAME"
    echo "ğŸ“‚ å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: $TARGET_DIR"
    echo "ğŸ“… å®Ÿè¡Œæ™‚åˆ»: $(date)"
    
    # Phase 1: åˆ†æå®Ÿè¡Œ
    echo "ğŸ” Phase 1: åˆ†æå®Ÿè¡Œ"
    ./scripts/phase1_analysis.sh
    if [ $? -ne 0 ]; then
        echo "âŒ Phase 1 å¤±æ•—"
        exit 1
    fi
    
    # Phase 2: å®‰å…¨å‰Šé™¤å®Ÿè¡Œ
    echo "ğŸ—‘ï¸ Phase 2: å®‰å…¨å‰Šé™¤å®Ÿè¡Œ"
    ./scripts/phase2_safe_removal.sh
    if [ $? -ne 0 ]; then
        echo "âŒ Phase 2 å¤±æ•—"
        exit 1
    fi
    
    # Phase 3: çµ±åˆå®Ÿè¡Œ
    echo "ğŸ“ Phase 3: çµ±åˆå®Ÿè¡Œ"
    ./scripts/phase3_consolidation.sh
    if [ $? -ne 0 ]; then
        echo "âŒ Phase 3 å¤±æ•—"
        exit 1
    fi
    
    # Phase 4: å‚ç…§æ›´æ–°å®Ÿè¡Œ
    echo "ğŸ”— Phase 4: å‚ç…§æ›´æ–°å®Ÿè¡Œ"
    ./scripts/phase4_reference_update.sh
    if [ $? -ne 0 ]; then
        echo "âŒ Phase 4 å¤±æ•—"
        exit 1
    fi
    
    # Phase 5: æ¤œè¨¼å®Ÿè¡Œ
    echo "âœ… Phase 5: æ¤œè¨¼å®Ÿè¡Œ"
    ./scripts/phase5_verification.sh
    if [ $? -ne 0 ]; then
        echo "âŒ Phase 5 å¤±æ•—"
        exit 1
    fi
    
    echo "ğŸ‰ çµ±åˆå®Ÿè¡Œå®Œäº†"
}

# çµ±åˆå®Ÿè¡Œ
execute_integration

# å®Œäº†å ±å‘Š
echo "ğŸ“Š çµ±åˆå®Ÿè¡Œçµæœ:"
echo "- å®Ÿè¡Œæ™‚é–“: $(date)"
echo "- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: $LOG_DIR/integration_$TIMESTAMP.log"
echo "- çŠ¶æ…‹: æˆåŠŸ"
```

### ğŸ“‹ Phaseå®Ÿè¡Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```bash
#!/bin/bash
# æ®µéšå®Ÿè¡Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
# ç”¨é€”: å„Phaseå€‹åˆ¥å®Ÿè¡Œã®è‡ªå‹•åŒ–

execute_phase() {
    local phase_number=$1
    local phase_name=$2
    local phase_script=$3
    
    echo "=== Phase $phase_number: $phase_name ==="
    
    # äº‹å‰ãƒã‚§ãƒƒã‚¯
    if [ ! -f "$phase_script" ]; then
        echo "âŒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $phase_script"
        return 1
    fi
    
    # å®Ÿè¡Œå‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    local backup_name="phase${phase_number}_pre_backup_$(date +%Y%m%d_%H%M%S).tar.gz"
    echo "ğŸ’¾ å®Ÿè¡Œå‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ: $backup_name"
    tar -czf "$BACKUP_DIR/$backup_name" --exclude=Archive .
    
    # Phaseå®Ÿè¡Œ
    echo "ğŸš€ Phase $phase_number å®Ÿè¡Œä¸­..."
    chmod +x "$phase_script"
    "$phase_script"
    local result=$?
    
    # å®Ÿè¡Œå¾Œæ¤œè¨¼
    if [ $result -eq 0 ]; then
        echo "âœ… Phase $phase_number å®Œäº†"
        
        # å®Ÿè¡Œå¾Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
        local post_backup_name="phase${phase_number}_post_backup_$(date +%Y%m%d_%H%M%S).tar.gz"
        echo "ğŸ’¾ å®Ÿè¡Œå¾Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ: $post_backup_name"
        tar -czf "$BACKUP_DIR/$post_backup_name" --exclude=Archive .
        
        return 0
    else
        echo "âŒ Phase $phase_number å¤±æ•—"
        
        # è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
        echo "ğŸ”„ è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œä¸­..."
        tar -xzf "$BACKUP_DIR/$backup_name"
        echo "ğŸ”„ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œäº†"
        
        return 1
    fi
}

# ä½¿ç”¨ä¾‹
# execute_phase 1 "åˆ†ææ®µéš" "./scripts/phase1_analysis.sh"
# execute_phase 2 "å®‰å…¨å‰Šé™¤æ®µéš" "./scripts/phase2_safe_removal.sh"
```

## 2. å“è³ªä¿è¨¼è‡ªå‹•åŒ–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### ğŸ” è‡ªå‹•å“è³ªãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 
```bash
#!/bin/bash
# è‡ªå‹•å“è³ªãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 
# ç”¨é€”: ç¶™ç¶šçš„å“è³ªç›£è¦–ã®è‡ªå‹•åŒ–

echo "=== Automated Quality Check System ==="

# å“è³ªãƒã‚§ãƒƒã‚¯çµæœæ ¼ç´
QUALITY_RESULTS_DIR="quality_results"
mkdir -p "$QUALITY_RESULTS_DIR"

# å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
run_quality_checks() {
    local check_timestamp=$(date +%Y%m%d_%H%M%S)
    local results_file="$QUALITY_RESULTS_DIR/quality_check_$check_timestamp.json"
    
    echo "ğŸ“Š å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œé–‹å§‹"
    
    # çµæœJSONåˆæœŸåŒ–
    cat > "$results_file" << EOF
{
    "timestamp": "$(date -Iseconds)",
    "project": "$PROJECT_NAME",
    "checks": {
EOF
    
    # å®Œå…¨æ€§ãƒã‚§ãƒƒã‚¯
    echo "ğŸ” å®Œå…¨æ€§ãƒã‚§ãƒƒã‚¯"
    local total_files=$(find . -type f -not -path "./Archive/*" | wc -l)
    local processed_files=$(find Archive/ -type f | wc -l)
    local completeness=$(echo "scale=2; $processed_files * 100 / ($total_files + $processed_files)" | bc)
    
    cat >> "$results_file" << EOF
        "completeness": {
            "score": $completeness,
            "target": 100,
            "status": "$([ $(echo "$completeness >= 95" | bc) -eq 1 ] && echo 'PASS' || echo 'FAIL')",
            "details": {
                "total_files": $total_files,
                "processed_files": $processed_files
            }
        },
EOF
    
    # æ­£ç¢ºæ€§ãƒã‚§ãƒƒã‚¯
    echo "ğŸ” æ­£ç¢ºæ€§ãƒã‚§ãƒƒã‚¯"
    local broken_links=$(grep -r "broken-link" . --exclude-dir=Archive | wc -l)
    local accuracy=$(echo "scale=2; (1 - $broken_links / 1000) * 100" | bc)
    
    cat >> "$results_file" << EOF
        "accuracy": {
            "score": $accuracy,
            "target": 100,
            "status": "$([ $broken_links -eq 0 ] && echo 'PASS' || echo 'FAIL')",
            "details": {
                "broken_links": $broken_links
            }
        },
EOF
    
    # æ€§èƒ½ãƒã‚§ãƒƒã‚¯
    echo "ğŸ” æ€§èƒ½ãƒã‚§ãƒƒã‚¯"
    local start_time=$(date +%s)
    find Archive/ -type f > /dev/null
    local end_time=$(date +%s)
    local duration=$((end_time - start_time))
    local performance_score=$(echo "scale=2; $processed_files / $duration" | bc)
    
    cat >> "$results_file" << EOF
        "performance": {
            "score": $performance_score,
            "target": 100,
            "status": "$([ $(echo "$performance_score >= 50" | bc) -eq 1 ] && echo 'PASS' || echo 'FAIL')",
            "details": {
                "files_per_second": $performance_score,
                "duration_seconds": $duration
            }
        }
EOF
    
    # JSONçµ‚äº†
    cat >> "$results_file" << EOF
    },
    "overall_status": "$([ $broken_links -eq 0 ] && [ $(echo "$completeness >= 95" | bc) -eq 1 ] && echo 'PASS' || echo 'FAIL')"
}
EOF
    
    echo "ğŸ“Š å“è³ªãƒã‚§ãƒƒã‚¯å®Œäº†: $results_file"
    
    # å“è³ªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    generate_quality_report "$results_file"
}

# å“è³ªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
generate_quality_report() {
    local results_file=$1
    local report_file="$QUALITY_RESULTS_DIR/quality_report_$(date +%Y%m%d_%H%M%S).html"
    
    echo "ğŸ“„ å“è³ªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ: $report_file"
    
    cat > "$report_file" << EOF
<!DOCTYPE html>
<html>
<head>
    <title>å“è³ªãƒ¬ãƒãƒ¼ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #f0f0f0; padding: 20px; border-radius: 5px; }
        .metric { margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { background: #d4edda; border-color: #c3e6cb; }
        .fail { background: #f8d7da; border-color: #f5c6cb; }
        .score { font-size: 24px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ å“è³ªãƒ¬ãƒãƒ¼ãƒˆ</h1>
        <p>ç”Ÿæˆæ—¥æ™‚: $(date)</p>
        <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: $PROJECT_NAME</p>
    </div>
    
    <div class="metric pass">
        <h3>ğŸ“Š å®Œå…¨æ€§</h3>
        <div class="score">$(jq -r '.checks.completeness.score' "$results_file")%</div>
        <p>çŠ¶æ…‹: $(jq -r '.checks.completeness.status' "$results_file")</p>
    </div>
    
    <div class="metric pass">
        <h3>ğŸ¯ æ­£ç¢ºæ€§</h3>
        <div class="score">$(jq -r '.checks.accuracy.score' "$results_file")%</div>
        <p>çŠ¶æ…‹: $(jq -r '.checks.accuracy.status' "$results_file")</p>
    </div>
    
    <div class="metric pass">
        <h3>âš¡ æ€§èƒ½</h3>
        <div class="score">$(jq -r '.checks.performance.score' "$results_file") files/sec</div>
        <p>çŠ¶æ…‹: $(jq -r '.checks.performance.status' "$results_file")</p>
    </div>
    
    <div class="metric $([ "$(jq -r '.overall_status' "$results_file")" = "PASS" ] && echo 'pass' || echo 'fail')">
        <h3>ğŸ† ç·åˆè©•ä¾¡</h3>
        <div class="score">$(jq -r '.overall_status' "$results_file")</div>
    </div>
</body>
</html>
EOF
    
    echo "ğŸ“„ å“è³ªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†"
}

# å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
run_quality_checks
```

## 3. ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè‡ªå‹•åŒ–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### ğŸ“Š ç¶™ç¶šç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
```bash
#!/bin/bash
# ç¶™ç¶šç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
# ç”¨é€”: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å“è³ªç›£è¦–ã®è‡ªå‹•åŒ–

echo "=== Continuous Monitoring System ==="

# ç›£è¦–è¨­å®š
MONITORING_INTERVAL=300  # 5åˆ†é–“éš”
ALERT_THRESHOLD_ERRORS=5
ALERT_THRESHOLD_PERFORMANCE=10
MONITORING_LOG="$LOG_DIR/monitoring_$(date +%Y%m%d).log"

# ç›£è¦–å®Ÿè¡Œ
start_monitoring() {
    echo "ğŸ” ç¶™ç¶šç›£è¦–é–‹å§‹"
    echo "ğŸ“… é–‹å§‹æ™‚åˆ»: $(date)"
    echo "â° ç›£è¦–é–“éš”: ${MONITORING_INTERVAL}ç§’"
    
    while true; do
        monitor_cycle
        sleep $MONITORING_INTERVAL
    done
}

# ç›£è¦–ã‚µã‚¤ã‚¯ãƒ«
monitor_cycle() {
    local timestamp=$(date -Iseconds)
    echo "[$timestamp] ç›£è¦–ã‚µã‚¤ã‚¯ãƒ«å®Ÿè¡Œ" >> "$MONITORING_LOG"
    
    # å‚ç…§ã‚¨ãƒ©ãƒ¼ç›£è¦–
    monitor_reference_errors
    
    # æ€§èƒ½ç›£è¦–
    monitor_performance
    
    # ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ç›£è¦–
    monitor_disk_usage
    
    # ã‚·ã‚¹ãƒ†ãƒ è² è·ç›£è¦–
    monitor_system_load
}

# å‚ç…§ã‚¨ãƒ©ãƒ¼ç›£è¦–
monitor_reference_errors() {
    local error_count=$(grep -r "broken-link" . --exclude-dir=Archive | wc -l)
    
    if [ $error_count -gt $ALERT_THRESHOLD_ERRORS ]; then
        send_alert "å‚ç…§ã‚¨ãƒ©ãƒ¼" "å‚ç…§ã‚¨ãƒ©ãƒ¼æ•°: $error_count (é–¾å€¤: $ALERT_THRESHOLD_ERRORS)"
        echo "ğŸš¨ ALERT: å‚ç…§ã‚¨ãƒ©ãƒ¼è¶…é ($error_count > $ALERT_THRESHOLD_ERRORS)" >> "$MONITORING_LOG"
    else
        echo "âœ… å‚ç…§ã‚¨ãƒ©ãƒ¼: $error_count (æ­£å¸¸)" >> "$MONITORING_LOG"
    fi
}

# æ€§èƒ½ç›£è¦–
monitor_performance() {
    local start_time=$(date +%s)
    find Archive/ -type f > /dev/null
    local end_time=$(date +%s)
    local duration=$((end_time - start_time))
    
    if [ $duration -gt $ALERT_THRESHOLD_PERFORMANCE ]; then
        send_alert "æ€§èƒ½åŠ£åŒ–" "å‡¦ç†æ™‚é–“: ${duration}ç§’ (é–¾å€¤: ${ALERT_THRESHOLD_PERFORMANCE}ç§’)"
        echo "ğŸš¨ ALERT: æ€§èƒ½åŠ£åŒ– ($duration > $ALERT_THRESHOLD_PERFORMANCE)" >> "$MONITORING_LOG"
    else
        echo "âœ… æ€§èƒ½: ${duration}ç§’ (æ­£å¸¸)" >> "$MONITORING_LOG"
    fi
}

# ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
send_alert() {
    local subject=$1
    local message=$2
    local timestamp=$(date -Iseconds)
    
    # ãƒ­ã‚°è¨˜éŒ²
    echo "[$timestamp] ALERT: $subject - $message" >> "$MONITORING_LOG"
    
    # ã‚¢ãƒ©ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
    local alert_file="$LOG_DIR/alert_$(date +%Y%m%d_%H%M%S).json"
    cat > "$alert_file" << EOF
{
    "timestamp": "$timestamp",
    "level": "ERROR",
    "subject": "$subject",
    "message": "$message",
    "project": "$PROJECT_NAME"
}
EOF
    
    # é€šçŸ¥é€ä¿¡ï¼ˆå®Ÿè£…ä¾‹ï¼‰
    if command -v curl &> /dev/null; then
        curl -X POST -H "Content-Type: application/json" \
            -d @"$alert_file" \
            "https://hooks.slack.com/services/YOUR/WEBHOOK/URL" 2>/dev/null || true
    fi
}

# ç›£è¦–é–‹å§‹
start_monitoring
```

## 4. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§è‡ªå‹•åŒ–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### ğŸ’¾ è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 
```bash
#!/bin/bash
# è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 
# ç”¨é€”: å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®è‡ªå‹•åŒ–

echo "=== Automated Backup System ==="

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š
BACKUP_BASE_DIR="Archive/Backup-Snapshots"
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION_LEVEL=6

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
create_backup() {
    local backup_type=$1  # daily, weekly, emergency
    local backup_name="${backup_type}_backup_$(date +%Y%m%d_%H%M%S)"
    local backup_path="$BACKUP_BASE_DIR/$backup_name.tar.gz"
    
    echo "ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆé–‹å§‹: $backup_name"
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª
    mkdir -p "$BACKUP_BASE_DIR"
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
    tar -czf "$backup_path" \
        --exclude=Archive \
        --exclude=logs \
        --exclude=quality_results \
        --exclude="*.tmp" \
        --exclude="*.log" \
        .
    
    local backup_size=$(du -h "$backup_path" | cut -f1)
    echo "ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆå®Œäº†: $backup_path ($backup_size)"
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æƒ…å ±è¨˜éŒ²
    local backup_info="$BACKUP_BASE_DIR/backup_info.json"
    local backup_record=$(cat << EOF
{
    "name": "$backup_name",
    "type": "$backup_type",
    "path": "$backup_path",
    "size": "$backup_size",
    "timestamp": "$(date -Iseconds)",
    "retention_until": "$(date -d "+$BACKUP_RETENTION_DAYS days" -Iseconds)"
}
EOF
    )
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
    if [ -f "$backup_info" ]; then
        # æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
        jq ". + [$backup_record]" "$backup_info" > "$backup_info.tmp"
        mv "$backup_info.tmp" "$backup_info"
    else
        # æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
        echo "[$backup_record]" > "$backup_info"
    fi
    
    echo "ğŸ“‹ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æƒ…å ±è¨˜éŒ²å®Œäº†"
}

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¸…æƒ
cleanup_old_backups() {
    echo "ğŸ—‘ï¸ å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¸…æƒé–‹å§‹"
    
    local backup_info="$BACKUP_BASE_DIR/backup_info.json"
    local current_time=$(date +%s)
    
    if [ -f "$backup_info" ]; then
        # æœŸé™åˆ‡ã‚Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ç‰¹å®š
        local expired_backups=$(jq -r ".[] | select(.retention_until < \"$(date -Iseconds)\") | .path" "$backup_info")
        
        # æœŸé™åˆ‡ã‚Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤
        echo "$expired_backups" | while read -r backup_path; do
            if [ -f "$backup_path" ]; then
                rm -f "$backup_path"
                echo "ğŸ—‘ï¸ å‰Šé™¤: $backup_path"
            fi
        done
        
        # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æƒ…å ±ã‹ã‚‰å‰Šé™¤æ¸ˆã¿ã‚’é™¤å¤–
        jq "[.[] | select(.retention_until >= \"$(date -Iseconds)\")]" "$backup_info" > "$backup_info.tmp"
        mv "$backup_info.tmp" "$backup_info"
    fi
    
    echo "ğŸ—‘ï¸ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¸…æƒå®Œäº†"
}

# å¾©æ—§å®Ÿè¡Œ
restore_backup() {
    local backup_name=$1
    local backup_path="$BACKUP_BASE_DIR/$backup_name.tar.gz"
    
    echo "ğŸ”„ å¾©æ—§å®Ÿè¡Œé–‹å§‹: $backup_name"
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
    if [ ! -f "$backup_path" ]; then
        echo "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $backup_path"
        return 1
    fi
    
    # ç¾åœ¨çŠ¶æ…‹ã®ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    local emergency_backup="emergency_before_restore_$(date +%Y%m%d_%H%M%S).tar.gz"
    echo "ğŸ’¾ å¾©æ—§å‰ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $emergency_backup"
    tar -czf "$BACKUP_BASE_DIR/$emergency_backup" --exclude=Archive .
    
    # å¾©æ—§å®Ÿè¡Œ
    echo "ğŸ”„ å¾©æ—§å®Ÿè¡Œä¸­..."
    tar -xzf "$backup_path"
    
    echo "âœ… å¾©æ—§å®Œäº†: $backup_name"
    echo "ğŸ’¾ ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $BACKUP_BASE_DIR/$emergency_backup"
}

# ä½¿ç”¨ä¾‹
# create_backup "daily"
# create_backup "weekly"
# create_backup "emergency"
# cleanup_old_backups
# restore_backup "daily_backup_20250711_120000"
```

## 5. çµ±åˆãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### ğŸ§ª è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 
```bash
#!/bin/bash
# è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 
# ç”¨é€”: çµ±åˆãƒ—ãƒ­ã‚»ã‚¹ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ

echo "=== Automated Test System ==="

# ãƒ†ã‚¹ãƒˆè¨­å®š
TEST_RESULTS_DIR="test_results"
TEST_DATA_DIR="test_data"

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
run_integration_tests() {
    echo "ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹"
    
    # ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™
    setup_test_environment
    
    # ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œ
    run_test_suite "unit_tests" "å˜ä½“ãƒ†ã‚¹ãƒˆ"
    run_test_suite "integration_tests" "çµ±åˆãƒ†ã‚¹ãƒˆ"
    run_test_suite "performance_tests" "æ€§èƒ½ãƒ†ã‚¹ãƒˆ"
    
    # ãƒ†ã‚¹ãƒˆçµæœé›†è¨ˆ
    aggregate_test_results
    
    echo "ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†"
}

# ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™
setup_test_environment() {
    echo "ğŸ”§ ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™"
    
    # ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    mkdir -p "$TEST_RESULTS_DIR"
    mkdir -p "$TEST_DATA_DIR"
    
    # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
    generate_test_data
    
    echo "ğŸ”§ ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™å®Œäº†"
}

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
generate_test_data() {
    echo "ğŸ“ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ"
    
    # ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
    for i in {1..10}; do
        echo "Test content $i" > "$TEST_DATA_DIR/test_file_$i.txt"
    done
    
    # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    mkdir -p "$TEST_DATA_DIR/test_dir"/{subdir1,subdir2,subdir3}
    
    # å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
    echo "Link to test_file_1.txt" > "$TEST_DATA_DIR/test_reference.md"
    
    echo "ğŸ“ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†"
}

# ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œ
run_test_suite() {
    local suite_name=$1
    local suite_description=$2
    local test_start_time=$(date +%s)
    local test_result_file="$TEST_RESULTS_DIR/${suite_name}_$(date +%Y%m%d_%H%M%S).json"
    
    echo "ğŸ§ª å®Ÿè¡Œä¸­: $suite_description"
    
    # ãƒ†ã‚¹ãƒˆçµæœåˆæœŸåŒ–
    cat > "$test_result_file" << EOF
{
    "suite_name": "$suite_name",
    "description": "$suite_description",
    "start_time": "$(date -Iseconds)",
    "tests": [
EOF
    
    # ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ
    case "$suite_name" in
        "unit_tests")
            run_unit_tests "$test_result_file"
            ;;
        "integration_tests")
            run_integration_test_cases "$test_result_file"
            ;;
        "performance_tests")
            run_performance_test_cases "$test_result_file"
            ;;
    esac
    
    # ãƒ†ã‚¹ãƒˆçµæœçµ‚äº†
    local test_end_time=$(date +%s)
    local test_duration=$((test_end_time - test_start_time))
    
    # JSONçµ‚äº†ï¼ˆæœ€å¾Œã®ã‚«ãƒ³ãƒã‚’å‰Šé™¤ï¼‰
    sed -i '$ s/,$//' "$test_result_file"
    
    cat >> "$test_result_file" << EOF
    ],
    "end_time": "$(date -Iseconds)",
    "duration_seconds": $test_duration,
    "status": "COMPLETED"
}
EOF
    
    echo "âœ… å®Œäº†: $suite_description ($test_durationç§’)"
}

# å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
run_unit_tests() {
    local result_file=$1
    
    # ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒ†ã‚¹ãƒˆ
    run_test_case "file_existence_test" "ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª" "$result_file" "
        if [ -f '$TEST_DATA_DIR/test_file_1.txt' ]; then
            echo 'PASS'
        else
            echo 'FAIL'
        fi
    "
    
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãƒ†ã‚¹ãƒˆ
    run_test_case "directory_structure_test" "ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ç¢ºèª" "$result_file" "
        if [ -d '$TEST_DATA_DIR/test_dir' ]; then
            echo 'PASS'
        else
            echo 'FAIL'
        fi
    "
}

# ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ
run_test_case() {
    local test_name=$1
    local test_description=$2
    local result_file=$3
    local test_command=$4
    
    local test_start=$(date +%s)
    local test_result=$(eval "$test_command")
    local test_end=$(date +%s)
    local test_duration=$((test_end - test_start))
    
    # ãƒ†ã‚¹ãƒˆçµæœè¨˜éŒ²
    cat >> "$result_file" << EOF
        {
            "name": "$test_name",
            "description": "$test_description",
            "result": "$test_result",
            "duration_seconds": $test_duration,
            "timestamp": "$(date -Iseconds)"
        },
EOF
    
    echo "  âœ… $test_description: $test_result"
}

# ãƒ†ã‚¹ãƒˆçµæœé›†è¨ˆ
aggregate_test_results() {
    echo "ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœé›†è¨ˆ"
    
    local summary_file="$TEST_RESULTS_DIR/test_summary_$(date +%Y%m%d_%H%M%S).html"
    
    cat > "$summary_file" << EOF
<!DOCTYPE html>
<html>
<head>
    <title>ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #f0f0f0; padding: 20px; border-radius: 5px; }
        .suite { margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { color: green; }
        .fail { color: red; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§ª ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h1>
        <p>å®Ÿè¡Œæ—¥æ™‚: $(date)</p>
    </div>
    
    <div class="suite">
        <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆçµ±è¨ˆ</h3>
        <p>å®Ÿè¡Œãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ•°: $(ls -1 "$TEST_RESULTS_DIR"/*.json | wc -l)</p>
        <p>ç·ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°: $(jq -r '[.tests[].result] | length' "$TEST_RESULTS_DIR"/*.json | paste -sd+ | bc)</p>
        <p>æˆåŠŸç‡: $(echo "scale=2; $(jq -r '[.tests[].result] | map(select(. == "PASS")) | length' "$TEST_RESULTS_DIR"/*.json | paste -sd+ | bc) * 100 / $(jq -r '[.tests[].result] | length' "$TEST_RESULTS_DIR"/*.json | paste -sd+ | bc)" | bc)%</p>
    </div>
</body>
</html>
EOF
    
    echo "ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœé›†è¨ˆå®Œäº†: $summary_file"
}

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
run_integration_tests
```

---
**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Œæˆ**: 2025-07-11 12:30
**ä½œæˆè€…**: dev4 (ã‚·ã‚¹ãƒ†ãƒ åˆ†æãƒ»çµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³è¨­è¨ˆ)
**é©ç”¨ç¯„å›²**: ğŸŒ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºçµ±åˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨èˆ¬