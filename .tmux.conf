# News Delivery System - tmux Configuration
# ニュース自動配信システム用tmux設定

# 基本設定
set -g default-terminal "screen-256color"
set -g history-limit 10000
set -g mouse on

# エスケープ時間を短縮（Vimなどでの応答性向上）
set -sg escape-time 1

# ウィンドウとペインのインデックスを1から開始
set -g base-index 1
setw -g pane-base-index 1

# プレフィックスキーをCtrl+aに変更（オプション）
# set -g prefix C-a
# unbind C-b
# bind C-a send-prefix

# 設定ファイルのリロード
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# ペイン分割のキーバインド（より直感的に）
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# ペイン移動（Vim風）
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ペインサイズ調整
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ウィンドウ移動
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# ウィンドウ名の自動変更を無効化
setw -g automatic-rename off
setw -g allow-rename off

# アクティビティ監視
setw -g monitor-activity on
set -g visual-activity on

# ステータスライン設定
set -g status on
set -g status-interval 5
set -g status-position bottom

# ステータスライン色設定
set -g status-style bg=colour235,fg=white,dim

# 左側ステータス
set -g status-left-length 40
set -g status-left "#[fg=green]Session: #S #[fg=yellow]#I #[fg=cyan]#P"

# 右側ステータス
set -g status-right-length 80
set -g status-right "#[fg=cyan]%Y-%m-%d %H:%M #[fg=green]#(whoami)@#h"

# ウィンドウリスト
setw -g window-status-format " #I:#W#F "
setw -g window-status-current-format " #I:#W#F "

# ウィンドウの色設定
setw -g window-status-style bg=colour235,fg=colour245
setw -g window-status-current-style bg=colour240,fg=colour255,bold

# ペインボーダーとタイトル表示
set -g pane-border-style fg=colour235
set -g pane-active-border-style fg=colour240

# ペインタイトル表示設定（アイコンと役割名）
set -g pane-border-status top
set -g pane-border-format "#[fg=colour82,bg=colour235,bold] #{?pane_active,🔥,📋} #T "

# ペイン番号による自動タイトル設定（手動設定に変更）
# set-hook -g after-split-window 'run-shell "/mnt/e/news-delivery-system/scripts/tmux-pane-title.sh"'
# set-hook -g after-new-window 'run-shell "/mnt/e/news-delivery-system/scripts/tmux-pane-title.sh"'

# コマンドライン
set -g message-style fg=colour255,bg=colour235,bold

# News Delivery System専用設定
# セッション名のデフォルト設定
set -g default-command ''
set -g default-shell /bin/bash

# ログファイル監視用の設定
bind-key L new-window -n "logs" 'tail -f /mnt/e/news-delivery-system/data/logs/*.log'

# 緊急時のシステムチェック
bind-key C new-window -n "check" 'cd /mnt/e/news-delivery-system && python main.py check'

# 手動実行用ショートカット
bind-key D new-window -n "daily" 'cd /mnt/e/news-delivery-system && python main.py daily --verbose'
bind-key U new-window -n "urgent" 'cd /mnt/e/news-delivery-system && python main.py urgent --verbose'

# セッションの保存と復元（tmux-resurrectプラグイン使用時）
# set -g @resurrect-save 'S'
# set -g @resurrect-restore 'R'

# News Delivery Systemのカスタムレイアウト
# パターンA: 標準レイアウト用の設定
bind-key A run-shell 'cd /mnt/e/news-delivery-system && ./scripts/tmux-layout-pattern-a.sh'