# 🚀 セットアップガイド

## 📋 **事前準備**

### システム要件
- **OS**: Linux (Ubuntu 20.04+推奨)
- **Python**: 3.12以上
- **メモリ**: 2GB以上
- **ディスク**: 10GB以上の空き容量
- **ネットワーク**: 安定したインターネット接続

### 必要なアカウント・API
- **Gmailアカウント** (送信用・OAuth2設定済み)
- **NewsAPIキー** ([無料取得](https://newsapi.org/register))
- **DeepL APIキー** ([Pro版推奨](https://www.deepl.com/pro-api))
- **Claude APIキー** ([Anthropic](https://www.anthropic.com))
- **GNews APIキー** ([無料取得](https://gnews.io))

---

## 🔧 **1. システム環境構築**

### Python環境セットアップ
```bash
# Python 3.12インストール確認
python3 --version

# 仮想環境作成
python3 -m venv venv

# 仮想環境アクティベート
source venv/bin/activate

# pipアップグレード
pip install --upgrade pip
```

### 依存関係インストール
```bash
# プロジェクトの依存関係
pip install -r requirements.txt

# 開発用ツール
pip install -r requirements-dev.txt

# セキュリティスキャン用
pip install safety bandit pip-audit
```

---

## 📦 **2. プロジェクトセットアップ**

### リポジトリクローン
```bash
# HTTPSでクローン（推奨）
git clone https://github.com/Kensan196948G/news-delivery-system.git
cd news-delivery-system

# SSHでクローン（設定済みの場合）
git clone git@github.com:Kensan196948G/news-delivery-system.git
cd news-delivery-system
```

### ディレクトリ構造確認
```bash
# プロジェクト構造確認
tree -L 3

# 必要ディレクトリ作成
mkdir -p {data,logs,cache,backup}
mkdir -p docs/{api,guides}
```

---

## 🔑 **3. APIキー設定**

### 設定ファイル作成
```bash
# 設定テンプレートをコピー
cp config/config.json.example config/config.json

# 環境変数ファイル作成
touch .env
chmod 600 .env  # セキュリティ設定
```

### config.json編集
```json
{
  "system": {
    "version": "1.0.0",
    "timezone": "Asia/Tokyo",
    "language": "ja"
  },
  "api": {
    "newsapi_key": "YOUR_NEWSAPI_KEY_HERE",
    "deepl_api_key": "YOUR_DEEPL_KEY_HERE",
    "anthropic_api_key": "YOUR_CLAUDE_KEY_HERE",
    "gnews_api_key": "YOUR_GNEWS_KEY_HERE"
  },
  "paths": {
    "data_root": "./data",
    "logs": "./logs",
    "cache": "./cache",
    "backup": "./backup"
  },
  "delivery": {
    "recipients": ["your-email@gmail.com"],
    "schedule": ["07:00", "12:00", "18:00"],
    "sender_email": "your-gmail@gmail.com"
  },
  "collection": {
    "categories": {
      "domestic_social": {"enabled": true, "count": 10},
      "international_social": {"enabled": true, "count": 15},
      "tech": {"enabled": true, "count": 20},
      "security": {"enabled": true, "count": 20}
    }
  }
}
```

### 環境変数設定 (.env)
```bash
# Gmail設定
GMAIL_USER=your-gmail@gmail.com
GMAIL_APP_PASSWORD=your-app-password

# Gmail App Password取得方法
# 1. Googleアカウント → セキュリティ
# 2. 2段階認証を有効化
# 3. アプリパスワード生成
# 4. 生成されたパスワードを設定
```

---

## 🛠️ **4. データベース初期化**

### SQLiteデータベース作成
```bash
# データベース初期化スクリプト実行
python scripts/init_database.py

# テーブル作成確認
sqlite3 data/news.db ".tables"

# データベース構造確認
sqlite3 data/news.db ".schema"
```

### キャッシュディレクトリ設定
```bash
# キャッシュディレクトリ作成
mkdir -p cache/{api,dedup,translation}

# 権限設定
chmod 755 cache/
chmod 644 cache/*/ 2>/dev/null || true
```

---

## ⚡ **5. 動作確認**

### 基本機能テスト
```bash
# 仮想環境確認
source venv/bin/activate

# 設定ファイル検証
python src/utils/config_validator.py

# API接続テスト
python scripts/test_apis.py

# データベース接続テスト
python scripts/test_database.py
```

### ニュース収集テスト
```bash
# 個別コレクターテスト
python -m src.collectors.newsapi_collector --test
python -m src.collectors.gnews_collector --test

# 翻訳機能テスト
python -m src.processors.translator --test

# AI分析テスト
python -m src.processors.analyzer --test
```

### メール送信テスト
```bash
# Gmail接続テスト
python -m src.notifiers.gmail_sender --test

# HTML生成テスト
python -m src.generators.html_generator --test

# フルテスト実行
python src/main.py --mode test
```

---

## 📅 **6. スケジュール設定**

### Cron設定
```bash
# Cronタブ編集
crontab -e

# 以下を追加
# ニュース配信スケジュール
0 7,12,18 * * * cd /path/to/news-delivery-system && source venv/bin/activate && python src/main.py --mode daily

# バックアップスケジュール
0 2 * * 0 cd /path/to/news-delivery-system && bash scripts/full_backup.sh

# ヘルスチェック
0 1 1 * * cd /path/to/news-delivery-system && bash scripts/health_check.sh
```

### 自動設定スクリプト使用
```bash
# Cron自動設定
./scripts/setup_cron.sh

# 設定確認
crontab -l

# ログディレクトリ作成
mkdir -p logs/{cron,system,error}
```

---

## 🔒 **7. セキュリティ設定**

### ファイル権限設定
```bash
# 実行ファイル権限
chmod +x scripts/*.sh

# 設定ファイル権限（重要）
chmod 600 config/config.json
chmod 600 .env

# ディレクトリ権限
chmod 755 src/ data/ logs/
chmod 700 backup/
```

### GitHub Secrets設定
```bash
# Repository Settings → Secrets → Actions

# 必要なSecrets:
# - NEWSAPI_KEY
# - DEEPL_API_KEY  
# - ANTHROPIC_API_KEY
# - GNEWS_API_KEY
# - GMAIL_USER
# - GMAIL_APP_PASSWORD
```

---

## 🧪 **8. GitHub Actions連携**

### ワークフロー有効化
```bash
# .github/workflows/の確認
ls -la .github/workflows/

# 主要ワークフロー:
# - ci-cd.yml (CI/CD パイプライン)
# - security-automation.yml (セキュリティスキャン)
# - pr-automation.yml (PR自動処理)
# - issue-automation.yml (Issue自動管理)
# - docs-automation.yml (ドキュメント自動更新)
```

### Dependabot設定確認
```bash
# .github/dependabot.yml の確認
cat .github/dependabot.yml

# 依存関係自動更新が有効化されていることを確認
# - 毎週月曜日 9:00 JST
# - セキュリティ更新は即座適用
```

---

## 📊 **9. 監視・ログ設定**

### ログローテーション設定
```bash
# logrotate設定ファイル作成
sudo nano /etc/logrotate.d/news-delivery-system

# 内容:
/path/to/news-delivery-system/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    copytruncate
}
```

### 監視スクリプト設定
```bash
# ヘルスチェックスクリプトテスト
./scripts/health_check.sh

# エラー通知テスト
./scripts/error_notifier.sh "test" "Test notification"

# システム監視開始
./scripts/start_monitoring.sh
```

---

## 🎯 **10. 初回実行**

### 手動実行テスト
```bash
# 仮想環境アクティベート
source venv/bin/activate

# 設定確認
python src/main.py --config-check

# ドライラン実行
python src/main.py --mode dry-run

# 実際の配信テスト
python src/main.py --mode test-delivery
```

### 初回ニュース配信
```bash
# 朝刊配信テスト
python src/main.py --mode morning

# 配信ログ確認
tail -f logs/delivery_$(date +%Y%m).log

# エラーログ確認
tail -f logs/error_$(date +%Y%m).log
```

---

## ⚙️ **11. カスタマイズ設定**

### ニュースカテゴリ調整
```json
{
  "collection": {
    "categories": {
      "domestic_social": {
        "enabled": true,
        "count": 15,
        "keywords": ["政治", "経済", "社会"]
      },
      "tech": {
        "enabled": true,
        "count": 25,
        "keywords": ["AI", "機械学習", "クラウド"]
      }
    }
  }
}
```

### AI分析設定調整
```json
{
  "ai_analysis": {
    "summary_length": "200-250文字",
    "importance_threshold": 7,
    "keywords_count": 5,
    "sentiment_analysis": true,
    "parallel_processing": 5
  }
}
```

### 配信形式カスタマイズ
```json
{
  "delivery": {
    "format": "html",
    "include_pdf": true,
    "template": "modern",
    "urgent_notification": {
      "enabled": true,
      "importance_threshold": 9,
      "cvss_threshold": 8.0
    }
  }
}
```

---

## 🔧 **12. トラブルシューティング**

### よくある問題

#### API接続エラー
```bash
# APIキー確認
python scripts/validate_api_keys.py

# ネットワーク接続確認
curl -I https://newsapi.org/
curl -I https://api.deepl.com/
```

#### メール送信エラー
```bash
# Gmail設定確認
python scripts/test_gmail.py

# App Password再生成
# Google Account → Security → App Passwords
```

#### 権限エラー
```bash
# ファイル権限修正
chmod +x scripts/*.sh
chmod 600 config/config.json .env

# ディレクトリ権限修正
chmod 755 src/ data/ logs/
chmod 700 backup/
```

#### Cron実行エラー
```bash
# Cron実行ログ確認
journalctl -u cron
tail -f /var/log/syslog | grep CRON

# 手動実行確認
cd /path/to/news-delivery-system && source venv/bin/activate && python src/main.py --mode test
```

---

## 📞 **サポート・お問い合わせ**

### ログ確認方法
```bash
# システムログ
tail -f logs/system_$(date +%Y%m).log

# 配信ログ
tail -f logs/delivery_$(date +%Y%m).log

# エラーログ
tail -f logs/error_$(date +%Y%m).log

# GitHub Actions ログ
# https://github.com/Kensan196948G/news-delivery-system/actions
```

### 設定ファイル
- **メイン設定**: `config/config.json`
- **環境変数**: `.env`
- **システム仕様**: `CLAUDE.md`

### GitHub Issues
問題が発生した場合は [GitHub Issues](https://github.com/Kensan196948G/news-delivery-system/issues) で報告してください。

---

## ✅ **セットアップ完了チェックリスト**

- [ ] Python 3.12+ インストール済み
- [ ] 仮想環境作成・アクティベート済み
- [ ] 依存関係インストール済み
- [ ] APIキー設定完了
- [ ] Gmail App Password設定完了
- [ ] データベース初期化完了
- [ ] 設定ファイル作成・編集完了
- [ ] 基本機能テスト実行済み
- [ ] Cron設定完了
- [ ] GitHub Actions有効化済み
- [ ] 初回配信テスト成功
- [ ] ログ確認・監視設定済み

すべてのチェックが完了したら、ニュース自動配信システムの運用開始です！

---

**🎊 セットアップ完了おめでとうございます！**  
**毎日 7:00、12:00、18:00 に高品質なニュース配信をお楽しみください。**