# 🎯 News Delivery System - システム概要

## 📋 **システム概要**

**News Delivery System** は、複数のニュースソースから最新情報を自動収集し、AI分析・翻訳を行い、美しいHTMLメールで定期配信する全自動ニュース配信システムです。

---

## 🏗️ **システムアーキテクチャ**

### **システム構成図**
```
┌─────────────────────────────────────────────────────────────┐
│                    Linux System (Ubuntu)                     │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐                                              │
│  │   Linux     │  ← 7:00, 12:00, 18:00に自動起動           │
│  │    Cron     │                                              │
│  └──────┬──────┘                                              │
│         ↓                                                      │
│  ┌─────────────────────────────┐                             │
│  │    src/main.py (制御核)      │                             │
│  ├─────────────────────────────┤                             │
│  │ 1. ニュース収集              │ → NewsAPI, GNews, NVD       │
│  │ 2. 重複除去・翻訳           │ → DeepL API Pro              │
│  │ 3. AI分析・要約             │ → Claude API                 │
│  │ 4. HTML/PDF生成             │                              │
│  │ 5. Gmail配信                │ → Gmail SMTP                 │
│  │ 6. データ保存               │ → SQLite DB                  │
│  └─────────────────────────────┘                             │
│         ↓                                                      │
│  ┌─────────────────────────────┐                             │
│  │   データストレージ           │                              │
│  │   data/ (プロジェクト内)      │                             │
│  └─────────────────────────────┘                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔧 **技術スタック**

### **コア技術**
- **言語**: Python 3.11+
- **OS**: Linux (Ubuntu)
- **スケジューラ**: Linux Cron
- **データベース**: SQLite
- **メール**: Gmail SMTP (App Password)

### **外部API連携**
| API | 用途 | プラン | コスト |
|-----|------|-------|--------|
| **NewsAPI** | 一般ニュース収集 | 無料 | ¥0 |
| **GNews** | 補助ニュース収集 | 無料 | ¥0 |
| **NVD** | セキュリティ脆弱性 | 無料 | ¥0 |
| **DeepL** | 高品質翻訳 | Pro | ¥630/月 |
| **Claude** | AI分析・要約 | 従量課金 | ~¥1,000/月 |

### **Python主要ライブラリ**
```
aiohttp==3.9.0          # 非同期HTTP通信
anthropic==0.18.0       # Claude API
sqlite3                 # データベース（標準ライブラリ）
jinja2==3.1.2          # HTMLテンプレート
smtplib                 # Gmail送信（標準ライブラリ）
```

---

## 📊 **機能詳細**

### **1. 🔄 ニュース収集機能**

**デュアルソース戦略**
- **NewsAPI**: 国内ニュース + 国際ニュース一部
- **GNews**: 国際ニュース + 技術ニュース一部  
- **NVD**: セキュリティ脆弱性専用

**収集カテゴリ**
```
🇯🇵 国内社会 (10記事) ← NewsAPI
🌍 国際社会 (15記事) ← NewsAPI(7) + GNews(8)
💴 国内経済 (8記事)  ← NewsAPI  
💰 国際経済 (15記事) ← NewsAPI(7) + GNews(8)
💻 技術     (20記事) ← NewsAPI(10) + GNews(10)
🔒 セキュリティ (20記事) ← NVD + NewsAPI
─────────────────────────────────────
合計: 88記事/回 (3ソース)
```

### **2. 🌐 翻訳機能**

**DeepL API Pro連携**
- **対象**: 英語記事のタイトル・本文
- **処理**: 非同期バッチ翻訳
- **品質**: プロフェッショナル翻訳  
- **速度**: 1記事0.5秒、全体2分以内

**翻訳フロー**
```
英語記事(70記事) → DeepL API Pro → 日本語記事
                    ↓
           キャッシュ保存(24時間) → 高速化
```

### **3. 🧠 AI分析機能**

**Claude API連携**
- **要約**: 200-250文字の日本語要約
- **重要度**: 1-10スケールでの評価
- **キーワード**: 5個の重要キーワード抽出
- **分類**: カテゴリ・センチメント分析

**分析優先度**
```
上位20記事 → Claude AI詳細分析
残り記事   → 簡易分析（コスト最適化）
```

### **4. 📧 レポート生成・配信**

**HTML生成**
- **デザイン**: レスポンシブWebデザイン
- **構成**: ヘッダー・統計・記事一覧・フッター
- **スタイル**: プロフェッショナル・色分け重要度

**Gmail配信**
- **形式**: HTMLメール + PDF添付
- **認証**: App Password (OAuth2より安定)
- **配信先**: kensan1969@gmail.com
- **成功率**: 99%以上

---

## ⏰ **運用スケジュール**

### **定期実行**
```
07:00 🌅 → 朝刊配信 (前日夜～朝の情報)
12:00 🌞 → 昼刊配信 (朝～昼の情報)  
18:00 🌆 → 夕刊配信 (昼～夕の情報)
23:00 🗄️ → 週次バックアップ (日曜のみ)
```

### **緊急配信**
```
重要度10/10 → 即座配信
CVSS 9.0+  → 即座配信
```

---

## 📊 **システム性能**

### **処理性能**
| 処理段階 | 時間 | 並行度 |
|---------|------|--------|
| ニュース収集 | 2-3分 | 7並行 |
| 翻訳処理 | 1-2分 | バッチ処理 |
| AI分析 | 1-2分 | 5並行 |
| レポート生成 | 0.5分 | 単体 |
| **合計** | **5-8分** | **最適化済み** |

### **データ容量**
- **記事データ**: 約1MB/日
- **画像・添付**: なし（軽量化）
- **データベース**: 約365MB/年
- **バックアップ**: 圧縮で1/3削減

---

## 🔒 **セキュリティ・信頼性**

### **認証・アクセス制御**
- **APIキー**: 環境変数で暗号化管理
- **Gmail**: App Password（2FA必須）
- **ファイル**: 適切な権限設定
- **ログ**: 個人情報のマスキング

### **エラーハンドリング**
- **自動リトライ**: 最大3回
- **フォールバック**: 代替API自動切換
- **監視**: エラー率・応答時間監視
- **通知**: 重大エラー時の自動通知

### **データバックアップ**
- **頻度**: 週次（日曜23:00）
- **対象**: DB・ログ・設定・レポート
- **保持**: 12週間（3ヶ月）
- **圧縮**: gzip圧縮で容量削減

---

## 💰 **運用コスト**

### **月次コスト内訳**
```
DeepL API Pro:    ¥630/月 (翻訳無制限)
Claude API:       ~¥1,000/月 (AI分析)
Gmail:            ¥0 (Google無料)
Linux Server:     ¥0 (既存環境)
その他API:        ¥0 (無料枠内)
─────────────────────────────────
総額:             約¥1,630/月
```

### **コスト効率**
- **1日あたり**: 約¥54
- **1配信あたり**: 約¥18
- **1記事あたり**: 約¥0.6

---

## 📈 **導入効果**

### **定量的効果**
- **情報収集時間**: 90%削減（手動→自動）
- **情報源多様性**: 3倍増加（単一→複数ソース）
- **翻訳品質**: プロ級（DeepL Pro使用）
- **配信安定性**: 99%以上の成功率

### **定性的効果**
- **情報の網羅性**: 重要ニュースの見逃し防止
- **時間の有効活用**: 朝・昼・夕の最適タイミング配信
- **意思決定支援**: AI分析による重要度判定
- **専門性向上**: セキュリティ・技術情報の迅速把握

---

## 🛠️ **管理・メンテナンス**

### **日常運用**
- **監視**: 自動実行ログの確認
- **性能**: 処理時間・エラー率の監視
- **容量**: ディスク使用量の監視

### **定期メンテナンス**
- **週次**: バックアップ実行確認
- **月次**: API使用量・コスト確認
- **四半期**: システム性能レビュー

### **管理コマンド**
```bash
# システム状況確認
./scripts/cron_management.sh status

# ログ確認  
./scripts/cron_management.sh logs

# 手動テスト実行
./scripts/cron_management.sh test
```

---

## 🎯 **今後の拡張計画**

### **短期計画（3ヶ月）**
- [ ] 記事品質フィードバック機能
- [ ] API使用量最適化
- [ ] レポートデザイン改善

### **中期計画（6ヶ月）**
- [ ] 追加ニュースソース統合
- [ ] モバイル最適化
- [ ] 統計ダッシュボード

### **長期計画（1年）**
- [ ] 多言語対応拡張
- [ ] 機械学習による記事推薦
- [ ] Slack/Teams連携

---

## 📞 **サポート・問い合わせ**

### **技術サポート**
- **ログ確認**: `logs/` ディレクトリ参照
- **設定変更**: `config/config.json` 編集
- **緊急停止**: `./scripts/cron_management.sh remove`

### **ドキュメント**
- **配信仕様**: `docs/DELIVERY_SPECIFICATION.md`
- **スケジュール**: `docs/SCHEDULE_DETAILS.md`
- **システム概要**: `docs/SYSTEM_OVERVIEW.md` (当ドキュメント)

---

**🎊 News Delivery System は、kensan1969@gmail.com に世界クラスの自動ニュース配信サービスを提供しています！**