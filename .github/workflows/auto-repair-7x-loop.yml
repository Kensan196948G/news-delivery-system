name: ğŸ”„ 7x Infinite Auto Repair Loop System
# 7å›ãƒ«ãƒ¼ãƒ—â†’30åˆ†å¾…æ©Ÿã‚’æ°¸ç¶šçš„ã«ç¹°ã‚Šè¿”ã™è‡ªå‹•ä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ 

on:
  # è‡ªå‹•å®Ÿè¡Œ1: 30åˆ†ã”ã¨ã®å®šæœŸãƒã‚§ãƒƒã‚¯
  schedule:
    - cron: '*/30 * * * *'
  
  # è‡ªå‹•å®Ÿè¡Œ2: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å¤±æ•—æ™‚ã«è‡ªå‹•èµ·å‹•
  workflow_run:
    workflows:
      - "CI Pipeline"
      - "Security Check"
      - "Test Suite"
    types: [completed]
  
  # è‡ªå‹•å®Ÿè¡Œ3: Issueæ“ä½œæ™‚ã«è‡ªå‹•èµ·å‹•
  issues:
    types: [opened, closed, labeled, unlabeled]
  
  # æ‰‹å‹•å®Ÿè¡Œï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
  workflow_dispatch:
    inputs:
      force_repair:
        description: 'å¼·åˆ¶ä¿®å¾©å®Ÿè¡Œ'
        required: false
        default: false
        type: boolean
      target_issue:
        description: 'å¯¾è±¡Issueç•ªå·'
        required: false
        type: string

permissions:
  contents: write
  issues: write
  actions: write
  pull-requests: write

env:
  MAX_ATTEMPTS_PER_CYCLE: 7
  COOLDOWN_MINUTES: 30
  # ç„¡é™ãƒ«ãƒ¼ãƒ—è¨­å®š - ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã§æ°¸ç¶šçš„ã«å®Ÿè¡Œ
  REPAIR_LABEL: 'auto-repair-7x'
  IN_PROGRESS_LABEL: 'repair-in-progress'
  COMPLETED_LABEL: 'repair-completed'

jobs:
  # ã‚¸ãƒ§ãƒ–1: ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥ã¨Issueä½œæˆ
  detect-and-create-issue:
    name: ğŸ” Detect Errors and Create Issue
    runs-on: ubuntu-latest
    if: |
      github.event_name == 'workflow_run' &&
      github.event.workflow_run.conclusion == 'failure'
    
    outputs:
      issue_number: ${{ steps.create-issue.outputs.issue_number }}
      should_repair: ${{ steps.check-repair.outputs.should_repair }}
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
    
    - name: ğŸ” Check for existing issues
      id: check-existing
      run: |
        # æ—¢å­˜ã®ä¿®å¾©ä¸­Issueã‚’ãƒã‚§ãƒƒã‚¯
        EXISTING_ISSUES=$(gh issue list \
          --label "${{ env.REPAIR_LABEL }}" \
          --state open \
          --json number,title,labels \
          --jq '.[] | select(.labels[].name == "${{ env.IN_PROGRESS_LABEL }}") | .number')
        
        if [ -n "$EXISTING_ISSUES" ]; then
          echo "existing_issue=$EXISTING_ISSUES" >> $GITHUB_OUTPUT
          echo "has_existing=true" >> $GITHUB_OUTPUT
        else
          echo "has_existing=false" >> $GITHUB_OUTPUT
        fi
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: ğŸ“ Create repair issue
      id: create-issue
      if: steps.check-existing.outputs.has_existing != 'true'
      run: |
        # ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’åé›†
        WORKFLOW_NAME="${{ github.event.workflow_run.name }}"
        WORKFLOW_URL="${{ github.event.workflow_run.html_url }}"
        ERROR_TIME=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
        
        # Issueæœ¬æ–‡ã‚’ä½œæˆ
        ISSUE_BODY=$(cat << EOF
        ## ğŸš¨ è‡ªå‹•ä¿®å¾©ã‚¿ã‚¹ã‚¯ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ï¼‰
        
        **æ¤œå‡ºã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼:**
        - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼: $WORKFLOW_NAME
        - å¤±æ•—ãƒªãƒ³ã‚¯: $WORKFLOW_URL
        - æ¤œå‡ºæ™‚åˆ»: $ERROR_TIME
        
        ## ğŸ“Š ä¿®å¾©ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        
        ### ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«æƒ…å ±
        - ã‚µã‚¤ã‚¯ãƒ«ç•ªå·: 1
        - é–‹å§‹æ™‚åˆ»: $ERROR_TIME
        - çŠ¶æ…‹: å®Ÿè¡Œä¸­
        
        ### è©¦è¡Œã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
        - ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«å†…è©¦è¡Œ: 0/7
        - ç·è©¦è¡Œå›æ•°: 0
        - æˆåŠŸå›æ•°: 0
        - å¤±æ•—å›æ•°: 0
        
        ## ğŸ”„ ç„¡é™ãƒ«ãƒ¼ãƒ—è¨­å®š
        ã“ã®Issueã¯7å›ã®ä¿®å¾©è©¦è¡Œå¾Œã€30åˆ†ã®å¾…æ©Ÿã‚’æŒŸã‚“ã§è‡ªå‹•çš„ã«æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’é–‹å§‹ã—ã¾ã™ã€‚
        ä¿®å¾©ãŒæˆåŠŸã™ã‚‹ã¾ã§ã€ã¾ãŸã¯æ‰‹å‹•ã§ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã‚‹ã¾ã§ç„¡é™ã«ç¶™ç¶šã—ã¾ã™ã€‚
        
        ## ğŸ“ ä¿®å¾©ãƒ­ã‚°
        
        | æ™‚åˆ» | ã‚µã‚¤ã‚¯ãƒ« | è©¦è¡Œ | çµæœ | è©³ç´° |
        |------|---------|------|------|------|
        EOF
        )
        
        # Issueã‚’ä½œæˆ
        ISSUE_NUMBER=$(gh issue create \
          --title "ğŸ”§ Auto Repair [âˆ Loop]: $WORKFLOW_NAME failure" \
          --body "$ISSUE_BODY" \
          --label "${{ env.REPAIR_LABEL }}" \
          --label "${{ env.IN_PROGRESS_LABEL }}" \
          --assignee "${{ github.repository_owner }}" \
          | grep -oE '[0-9]+')
        
        echo "issue_number=$ISSUE_NUMBER" >> $GITHUB_OUTPUT
        echo "âœ… Created repair issue #$ISSUE_NUMBER"
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: ğŸ¯ Set repair flag
      id: check-repair
      run: |
        if [ "${{ steps.check-existing.outputs.has_existing }}" == "true" ]; then
          echo "should_repair=false" >> $GITHUB_OUTPUT
        else
          echo "should_repair=true" >> $GITHUB_OUTPUT
        fi

  # ã‚¸ãƒ§ãƒ–2: ä¿®å¾©ãƒ«ãƒ¼ãƒ—å®Ÿè¡Œ
  execute-repair-loop:
    name: ğŸ”§ Execute Infinite Repair Loop
    runs-on: ubuntu-latest
    needs: [detect-and-create-issue]
    if: |
      always() && (
        needs.detect-and-create-issue.outputs.should_repair == 'true' ||
        github.event_name == 'schedule' ||
        github.event_name == 'workflow_dispatch' ||
        (github.event_name == 'issues' && contains(github.event.issue.labels.*.name, 'auto-repair-7x'))
      )
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: ğŸ“¦ Install dependencies
      run: |
        pip install PyYAML requests

    - name: ğŸ” Find target issue
      id: find-issue
      run: |
        if [ "${{ github.event_name }}" == "issues" ]; then
          ISSUE_NUMBER="${{ github.event.issue.number }}"
        elif [ -n "${{ needs.detect-and-create-issue.outputs.issue_number }}" ]; then
          ISSUE_NUMBER="${{ needs.detect-and-create-issue.outputs.issue_number }}"
        elif [ -n "${{ github.event.inputs.target_issue }}" ]; then
          ISSUE_NUMBER="${{ github.event.inputs.target_issue }}"
        else
          # æœ€ã‚‚å¤ã„æœªè§£æ±ºã®repair issueã‚’å–å¾—
          ISSUE_NUMBER=$(gh issue list \
            --label "${{ env.REPAIR_LABEL }}" \
            --label "${{ env.IN_PROGRESS_LABEL }}" \
            --state open \
            --json number,createdAt \
            --jq 'sort_by(.createdAt) | .[0].number')
        fi
        
        if [ -z "$ISSUE_NUMBER" ]; then
          echo "No repair issues found"
          echo "has_issue=false" >> $GITHUB_OUTPUT
        else
          echo "issue_number=$ISSUE_NUMBER" >> $GITHUB_OUTPUT
          echo "has_issue=true" >> $GITHUB_OUTPUT
          echo "ğŸ“‹ Working on issue #$ISSUE_NUMBER"
        fi
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: ğŸ“Š Check repair state
      id: check-state
      if: steps.find-issue.outputs.has_issue == 'true'
      run: |
        ISSUE_NUMBER="${{ steps.find-issue.outputs.issue_number }}"
        
        # Issueæœ¬æ–‡ã‹ã‚‰ç¾åœ¨ã®çŠ¶æ…‹ã‚’è§£æ
        ISSUE_BODY=$(gh issue view $ISSUE_NUMBER --json body --jq '.body')
        
        # çŠ¶æ…‹æƒ…å ±ã‚’æŠ½å‡º
        CURRENT_CYCLE=$(echo "$ISSUE_BODY" | grep "ã‚µã‚¤ã‚¯ãƒ«ç•ªå·:" | head -1 | grep -oE '[0-9]+' || echo "1")
        ATTEMPT_IN_CYCLE=$(echo "$ISSUE_BODY" | grep "ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«å†…è©¦è¡Œ:" | head -1 | grep -oE '[0-9]+' | head -1 || echo "0")
        TOTAL_ATTEMPTS=$(echo "$ISSUE_BODY" | grep "ç·è©¦è¡Œå›æ•°:" | head -1 | grep -oE '[0-9]+' || echo "0")
        
        # æ¬¡ã®è©¦è¡Œç•ªå·ã‚’è¨ˆç®—
        NEXT_ATTEMPT_IN_CYCLE=$(( ($ATTEMPT_IN_CYCLE % ${{ env.MAX_ATTEMPTS_PER_CYCLE }}) + 1 ))
        
        # æœ€å¾Œã®ä¿®å¾©æ™‚åˆ»ã‚’å–å¾—
        LAST_ATTEMPT=$(gh issue view $ISSUE_NUMBER --json comments --jq '.comments[-1].createdAt // ""')
        
        # ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãƒã‚§ãƒƒã‚¯ï¼ˆã‚µã‚¤ã‚¯ãƒ«å®Œäº†å¾Œï¼‰
        if [ -n "$LAST_ATTEMPT" ] && [ "$ATTEMPT_IN_CYCLE" -eq "${{ env.MAX_ATTEMPTS_PER_CYCLE }}" ]; then
          LAST_TIMESTAMP=$(date -d "$LAST_ATTEMPT" +%s)
          CURRENT_TIMESTAMP=$(date +%s)
          ELAPSED_MINUTES=$(( ($CURRENT_TIMESTAMP - $LAST_TIMESTAMP) / 60 ))
          
          if [ "$ELAPSED_MINUTES" -lt "${{ env.COOLDOWN_MINUTES }}" ]; then
            REMAINING=$(( ${{ env.COOLDOWN_MINUTES }} - $ELAPSED_MINUTES ))
            echo "â¸ï¸ In cooldown period. $REMAINING minutes remaining."
            echo "in_cooldown=true" >> $GITHUB_OUTPUT
            exit 0
          else
            # ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³çµ‚äº†ã€æ–°ã—ã„ã‚µã‚¤ã‚¯ãƒ«ã‚’é–‹å§‹
            CURRENT_CYCLE=$((CURRENT_CYCLE + 1))
            NEXT_ATTEMPT_IN_CYCLE=1
            echo "ğŸ”„ Starting new cycle #$CURRENT_CYCLE after cooldown"
          fi
        fi
        
        echo "current_cycle=$CURRENT_CYCLE" >> $GITHUB_OUTPUT
        echo "attempt_in_cycle=$NEXT_ATTEMPT_IN_CYCLE" >> $GITHUB_OUTPUT
        echo "total_attempts=$TOTAL_ATTEMPTS" >> $GITHUB_OUTPUT
        echo "in_cooldown=false" >> $GITHUB_OUTPUT
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: â¸ï¸ Wait for cooldown
      if: steps.check-state.outputs.in_cooldown == 'true'
      run: |
        echo "Repair is in cooldown period. Exiting..."
        exit 0
    
    - name: ğŸ”§ Execute repair attempt
      id: repair
      if: |
        steps.find-issue.outputs.has_issue == 'true' &&
        steps.check-state.outputs.in_cooldown != 'true'
      timeout-minutes: 5
      run: |
        ISSUE_NUMBER="${{ steps.find-issue.outputs.issue_number }}"
        CURRENT_CYCLE="${{ steps.check-state.outputs.current_cycle }}"
        ATTEMPT_IN_CYCLE="${{ steps.check-state.outputs.attempt_in_cycle }}"
        TOTAL_ATTEMPTS="${{ steps.check-state.outputs.total_attempts }}"
        
        echo "ğŸ”§ Executing repair attempt (Total: $((TOTAL_ATTEMPTS + 1)), Cycle $CURRENT_CYCLE, Attempt $ATTEMPT_IN_CYCLE/7)"
        
        # ä¿®å¾©ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
        if [ -f "scripts/repair-loop-executor.py" ]; then
          python scripts/repair-loop-executor.py \
            --issue-number "$ISSUE_NUMBER" \
            --cycle "$CURRENT_CYCLE" \
            --attempt "$ATTEMPT_IN_CYCLE" \
            --total "$((TOTAL_ATTEMPTS + 1))"
          REPAIR_RESULT=$?
        else
          # ãƒ‡ãƒ¢ç”¨ã®ä¿®å¾©è©¦è¡Œï¼ˆå®Ÿéš›ã®ä¿®å¾©ãƒ­ã‚¸ãƒƒã‚¯ã«ç½®ãæ›ãˆã‚‹ï¼‰
          echo "Running repair logic..."
          # ã“ã“ã«å®Ÿéš›ã®ä¿®å¾©ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ 
          # ä¾‹: npm test, pytest, make fix ãªã©
          REPAIR_RESULT=$((RANDOM % 2))  # ãƒ‡ãƒ¢ç”¨ã®ãƒ©ãƒ³ãƒ€ãƒ çµæœ
        fi
        
        if [ "$REPAIR_RESULT" -eq 0 ]; then
          echo "repair_success=true" >> $GITHUB_OUTPUT
          echo "âœ… Repair attempt successful"
        else
          echo "repair_success=false" >> $GITHUB_OUTPUT
          echo "âŒ Repair attempt failed"
        fi
    
    - name: ğŸ“ Update issue status
      if: steps.find-issue.outputs.has_issue == 'true' && steps.repair.outcome != 'skipped'
      run: |
        ISSUE_NUMBER="${{ steps.find-issue.outputs.issue_number }}"
        CURRENT_CYCLE="${{ steps.check-state.outputs.current_cycle }}"
        ATTEMPT_IN_CYCLE="${{ steps.check-state.outputs.attempt_in_cycle }}"
        TOTAL_ATTEMPTS="${{ steps.check-state.outputs.total_attempts }}"
        REPAIR_SUCCESS="${{ steps.repair.outputs.repair_success }}"
        
        # Issueæœ¬æ–‡ã‚’å–å¾—
        ISSUE_BODY=$(gh issue view $ISSUE_NUMBER --json body --jq '.body')
        
        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        ATTEMPT_NUMBER=$((TOTAL_ATTEMPTS + 1))
        if [ "$REPAIR_SUCCESS" == "true" ]; then
          RESULT_EMOJI="âœ…"
          RESULT_TEXT="æˆåŠŸ"
        else
          RESULT_EMOJI="âŒ"
          RESULT_TEXT="å¤±æ•—"
        fi
        
        # ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’æ›´æ–°
        NEW_BODY=$(echo "$ISSUE_BODY" | 
          sed "s/ã‚µã‚¤ã‚¯ãƒ«ç•ªå·: [0-9]*/ã‚µã‚¤ã‚¯ãƒ«ç•ªå·: $CURRENT_CYCLE/" |
          sed "s/ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«å†…è©¦è¡Œ: [0-9]*\/7/ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«å†…è©¦è¡Œ: $ATTEMPT_IN_CYCLE\/7/" |
          sed "s/ç·è©¦è¡Œå›æ•°: [0-9]*/ç·è©¦è¡Œå›æ•°: $ATTEMPT_NUMBER/")
        
        if [ "$REPAIR_SUCCESS" == "true" ]; then
          SUCCESS_COUNT=$(echo "$ISSUE_BODY" | grep "æˆåŠŸå›æ•°:" | grep -oE '[0-9]+' || echo "0")
          NEW_BODY=$(echo "$NEW_BODY" | sed "s/æˆåŠŸå›æ•°: [0-9]*/æˆåŠŸå›æ•°: $((SUCCESS_COUNT + 1))/")
        else
          FAIL_COUNT=$(echo "$ISSUE_BODY" | grep "å¤±æ•—å›æ•°:" | grep -oE '[0-9]+' || echo "0")
          NEW_BODY=$(echo "$NEW_BODY" | sed "s/å¤±æ•—å›æ•°: [0-9]*/å¤±æ•—å›æ•°: $((FAIL_COUNT + 1))/")
        fi
        
        # Issueæœ¬æ–‡ã‚’æ›´æ–°
        echo "$NEW_BODY" | gh issue edit $ISSUE_NUMBER --body-file -
        
        # ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ–°ã—ã„è¡Œã‚’è¿½åŠ 
        TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
        NEW_LOG_ROW="| $TIMESTAMP | $CURRENT_CYCLE | $ATTEMPT_IN_CYCLE/7 | $RESULT_EMOJI | Attempt #$ATTEMPT_NUMBER |"
        
        gh issue comment $ISSUE_NUMBER --body "$NEW_LOG_ROW"
        
        # æˆåŠŸã—ãŸå ´åˆã¯Issueã‚’ã‚¯ãƒ­ãƒ¼ã‚º
        if [ "$REPAIR_SUCCESS" == "true" ]; then
          gh issue close $ISSUE_NUMBER --comment "ğŸ‰ ä¿®å¾©æˆåŠŸï¼è©¦è¡Œ #$ATTEMPT_NUMBER ã§å•é¡ŒãŒè§£æ±ºã—ã¾ã—ãŸã€‚"
          gh issue edit $ISSUE_NUMBER \
            --remove-label "${{ env.IN_PROGRESS_LABEL }}" \
            --add-label "${{ env.COMPLETED_LABEL }}"
        fi
        
        # ã‚µã‚¤ã‚¯ãƒ«çµ‚äº†æ™‚ã®å‡¦ç†
        if [ "$ATTEMPT_IN_CYCLE" -eq "${{ env.MAX_ATTEMPTS_PER_CYCLE }}" ] && [ "$REPAIR_SUCCESS" != "true" ]; then
          # æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ç•ªå·
          NEXT_CYCLE=$((CURRENT_CYCLE + 1))
          
          gh issue comment $ISSUE_NUMBER --body "## â¸ï¸ ã‚µã‚¤ã‚¯ãƒ« $CURRENT_CYCLE å®Œäº†
          
          7å›ã®ä¿®å¾©è©¦è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸã€‚
          30åˆ†ã®ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³å¾Œã€ã‚µã‚¤ã‚¯ãƒ« $NEXT_CYCLE ã‚’è‡ªå‹•çš„ã«é–‹å§‹ã—ã¾ã™ã€‚
          
          ğŸ”„ **ç„¡é™ãƒ«ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰**: ä¿®å¾©æˆåŠŸã¾ãŸã¯æ‰‹å‹•ã‚¯ãƒ­ãƒ¼ã‚ºã¾ã§ç¶™ç¶šã—ã¾ã™ã€‚"
        fi
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ã‚¸ãƒ§ãƒ–3: å®šæœŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  cleanup-old-issues:
    name: ğŸ§¹ Cleanup Old Issues
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
    
    - name: ğŸ§¹ Close stale issues
      run: |
        # 30æ—¥ä»¥ä¸Šæ›´æ–°ã•ã‚Œã¦ã„ãªã„ä¿®å¾©Issueã‚’ã‚¯ãƒ­ãƒ¼ã‚ºï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—ã§ã‚‚å¤ã™ãã‚‹ã‚‚ã®ã¯æ•´ç†ï¼‰
        STALE_DATE=$(date -u -d '30 days ago' +%Y-%m-%dT%H:%M:%SZ)
        
        gh issue list \
          --label "${{ env.REPAIR_LABEL }}" \
          --state open \
          --json number,updatedAt \
          --jq ".[] | select(.updatedAt < \"$STALE_DATE\") | .number" | \
        while read -r ISSUE_NUMBER; do
          if [ -n "$ISSUE_NUMBER" ]; then
            gh issue close $ISSUE_NUMBER \
              --comment "â° 30æ—¥é–“æ›´æ–°ãŒãªã„ãŸã‚ã€è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸã€‚"
            gh issue edit $ISSUE_NUMBER \
              --remove-label "${{ env.IN_PROGRESS_LABEL }}" \
              --add-label "auto-closed-stale"
          fi
        done
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}